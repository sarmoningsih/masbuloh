name: pop

on:
  push:
    branches: ["main"]

jobs:
  build:
    env:
      PY_COLORS: "1"
    name: Install Dependencies
    runs-on: ubuntu-latest
    strategy:
      max-parallel: 20
      fail-fast: false
      matrix:
        rangeIndex: ["3720 3721 1", "3720 3721 2", "3720 3721 3", "3720 3721 4", "3720 3721 5", "3720 3721 6", "3720 3721 7", "3721 3722 8", "3721 3722 9", "3721 3722 10", "3721 3722 11", "3721 3722 12", "3721 3722 13", "3721 3722 14", "3722 3723 15", "3722 3723 16", "3722 3723 17", "3722 3723 18", "3722 3723 19", "3722 3723 20", "3722 3723 21", "3723 3724 22", "3723 3724 23", "3723 3724 24", "3723 3724 25", "3723 3724 26", "3723 3724 27", "3723 3724 28", "3724 3725 29", "3724 3725 30", "3724 3725 31", "3724 3725 32", "3724 3725 33", "3724 3725 34", "3724 3725 35"]
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    - name: Add Dependencies
      uses: actions/setup-python@v5
      with:
        python-version: 3.12
    - name: Install Depedencies
      run: |
        python -m ensurepip --upgrade
        python -m pip install --upgrade pip wheel setuptools
        python -m pip install -r requirements.txt
        sudo apt install -y google-chrome-stable
        seleniumbase install chromedriver
        sudo apt install -y xvfb
    - name: Install OpenVPN
      run: |
        sudo apt update
        sudo apt install -y openvpn openvpn-systemd-resolved
        chmod +x ./setup.sh && ./setup.sh
        sleep 5
        ls -l
    - name: Your current IP address
      run: curl -s http://ipecho.net/plain
    - name: Connect to VPN
      uses: "kota65535/github-openvpn-connect-action@v2"
      with:
        config_file: ./con.ovpn
        echo_config: "false"
        username: "p3239220"
        password: "dDK44wuNpt"
    - name: Your vpn IP address
      run: curl -s http://ipecho.net/plain
    - name: Run
      run: |
        export DISPLAY=:0
        /usr/bin/Xvfb :0 -screen 0 1024x768x24 &
        sleep 5
        xvfb-run python run-n-login.py ${{ matrix.rangeIndex }}
    - name: done
      run: exit